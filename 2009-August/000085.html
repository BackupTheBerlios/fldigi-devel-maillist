<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> Fldigi time macros (was: Re: [Fwd: Fw: [raynethf] Local Common	Emergency Macros])
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/fldigi-devel/2009-August/index.html" >
   <LINK REL="made" HREF="mailto:fldigi-devel%40lists.berlios.de?Subject=Re%3A%20Fldigi%20time%20macros%20%28was%3A%20Re%3A%20%5BFwd%3A%20Fw%3A%20%5Braynethf%5D%20Local%20Common%0A%09Emergency%20Macros%5D%29&In-Reply-To=%3C87vdk6ikf6.wl%40obsidian.enotty.net%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000084.html">
   <LINK REL="Next"  HREF="000086.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Fldigi time macros (was: Re: [Fwd: Fw: [raynethf] Local Common	Emergency Macros])</H1>
    <B>Stelios Bounanos</B> 
    <A HREF="mailto:fldigi-devel%40lists.berlios.de?Subject=Re%3A%20Fldigi%20time%20macros%20%28was%3A%20Re%3A%20%5BFwd%3A%20Fw%3A%20%5Braynethf%5D%20Local%20Common%0A%09Emergency%20Macros%5D%29&In-Reply-To=%3C87vdk6ikf6.wl%40obsidian.enotty.net%3E"
       TITLE="Fldigi time macros (was: Re: [Fwd: Fw: [raynethf] Local Common	Emergency Macros])">m0gld at enotty.net
       </A><BR>
    <I>Sat Aug 29 19:45:01 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="000084.html">flrig and fldigi startup
</A></li>
        <LI>Next message: <A HREF="000086.html">pushed to pu/df
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85">[ date ]</a>
              <a href="thread.html#85">[ thread ]</a>
              <a href="subject.html#85">[ subject ]</a>
              <a href="author.html#85">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Mike,

Dave forwarded me a copy of your email regarding the time format
generated by fldigi macros.


First, a little background.  The standard (POSIX) way to format time as
a human-readable string is by using the following system functions:

time() -- obtain an integer representation of calendar time as the
          number of seconds elapsed since the epoch (1 Jan 1970 00:00:00
          UTC, not counting leap seconds).

Followed by:

gmtime() -- obtain a broken-down time information structure from the
            time() value, expressed in Coordinated Universal Time (UTC)

OR

localtime() -- obtain a broken-down time information structure from the
               time() value, expressed relative to the local time zone

Followed by:

strftime() -- obtain a human-readable string that describes the
              structure returned by gmtime() or localtime().  For
              example:  &quot;%Y-%m-%d %H:%M:%S&quot; might print
              &quot;2009-08-29 17:31:58&quot;.

&quot;%Y-%m-%d %H:%M:%S&quot; is an example of a format string.  POSIX specifies
numerous format characters (% followed by a character), including these
two:

  %z -- the offset from UTC in numerical format (-hhmm or +hhmm), e.g. +0100
  %Z -- the local timezone abbreviation, e.g. BST

This where Windows screws up, in two ways:

1) It seems that both %z and %Z print the same thing, the timezone
   abbreviation (e.g. BST).
2) The string returned is nonstandard and somewhat unpredictable.


I wrote a little test program that takes a format string and applies it
to both GMT and local time.  Here is what it says on Linux and Mac OS X
(and presumably also *BSD and all other Unix systems with a zoneinfo
database):

  ./d &quot;%Y-%m-%d %H:%M:%S %Z (%z)&quot;
  GMT:   2009-08-29 16:31:58 GMT (+0000)
  Local: 2009-08-29 17:31:58 BST (+0100)

And on the XP test VM:

  d.exe &quot;%Y-%m-%d %H:%M:%S %Z (%z)&quot;
  GMT:   2009-08-29 16:31:58 GMT Standard Time (GMT Standard Time)
  Local: 2009-08-29 17:31:58 GMT Standard Time (GMT Standard Time)

I then unchecked the option &quot;Automatically adjust clock for daylight
saving changes&quot; in the windows Control Panel.  This produced:

  GMT:   2009-08-29 16:31:58 GMT Standard Time (GMT Standard Time)
  Local: 2009-08-29 16:31:58 GMT Standard Time (GMT Standard Time)

Not so good. I enabled the same option again and now the output is
different(!):

  GMT:   2009-08-29 16:31:58 GMT Standard Time (GMT Standard Time)
  Local: 2009-08-29 17:31:58 GMT Daylight Time (GMT Daylight Time)


So this seems a bit broken on Windows. I can think of three workarounds:


1) Ask Windows users to set the TZ environment variable in the Control
   Panel (System-&gt;Advanced tab on XP) to the right value for their
   timezone.  For the UK it should be &quot;GMT0BST&quot; (without the quotes).

   If I set this, I get:

      GMT:   2009-08-29 16:31:58 GMT (GMT)
      Local: 2009-08-29 17:31:58 BST (BST)

   So you still lose the +hhmm information but at least you get the
   right timezone abbreviation.

   NOTE:

   The full TZ for the UK is actually &quot;GMT0BST,M3.5.0/1,M10.5.0&quot;, which
   also specifies the start/end dates&amp;times of the daylight saving
   period.  Windows doesn't seem to support all that &quot;extra stuff&quot;.
   Instead, it accepts and ignores it, and assumes US rules for the
   calculation of DST!

   Source: <A HREF="http://msdn.microsoft.com/en-us/library/90s5c885%28VS.80%29.aspx">http://msdn.microsoft.com/en-us/library/90s5c885%28VS.80%29.aspx</A>
   (Chalk another one up for Redmond!)

   For this reason this may not be a good solution for UK users...
   unless MS have fixed this in more recent Windows versions.


2) We implement two new fldigi macros, &lt;LOCALTIME:x&gt; and &lt;GMTIME:x&gt;,
   which will allow you to specify a format string so as to obtain the
   date and time from the system, but supply your own timezone string.
   Example:

     &lt;LOCALTIME:%Y-%m-%d %H:%M:%S&gt; BST

  expands to:

     2009-08-29 17:31:58 BST


3) You change your SOP and always use UTC times in ISO-8601 format :)
   Then the &lt;IZDT&gt; macro is sufficient:

     &lt;IZDT&gt;

   expands to

     2009-08-29 16:31Z


-- 

73,
Stelios, M0GLD.

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000084.html">flrig and fldigi startup
</A></li>
	<LI>Next message: <A HREF="000086.html">pushed to pu/df
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#85">[ date ]</a>
              <a href="thread.html#85">[ thread ]</a>
              <a href="subject.html#85">[ subject ]</a>
              <a href="author.html#85">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/fldigi-devel">More information about the fldigi-devel
mailing list</a><br>
</body></html>
